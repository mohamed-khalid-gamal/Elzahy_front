# Internationalization (i18n) Guide

This document explains how to use and maintain the bilingual support system in the ELZAHY GROUP Angular application.

## Overview

The application supports two languages:
- **English (en)** - Left-to-Right (LTR)
- **Arabic (ar)** - Right-to-Left (RTL)

The system uses `@ngx-translate/core` for runtime language switching and provides full RTL layout support for Arabic.

## Quick Start

### Switching Languages
Users can switch languages using the language toggle in the navigation header. The selection is persisted in localStorage and applied on subsequent visits.

### Adding New Translation Keys

1. **Add keys to translation files:**
   ```json
   // src/assets/i18n/en.json
   {
     "yourSection": {
       "newKey": "English text"
     }
   }
   
   // src/assets/i18n/ar.json
   {
     "yourSection": {
       "newKey": "النص العربي"
     }
   }
   ```

2. **Use in templates:**
   ```html
   <!-- Simple translation -->
   {{ 'yourSection.newKey' | translate }}
   
   <!-- With parameters -->
   {{ 'yourSection.greeting' | translate: {name: userName} }}
   
   <!-- Using directive -->
   <span translate>yourSection.newKey</span>
   ```

3. **Use in components:**
   ```typescript
   // Inject TranslateService or LanguageService
   constructor(private translateService: TranslateService) {}
   
   // Get translation
   const text = this.translateService.instant('yourSection.newKey');
   
   // Or with observable
   this.translateService.get('yourSection.newKey').subscribe(text => {
     console.log(text);
   });
   ```

## Translation File Structure

### Naming Convention
- Use nested keys for organization: `"section.subsection.key"`
- Use descriptive names: `"form.validation.emailRequired"`
- Keep keys consistent across languages

### File Organization
```
src/assets/i18n/
├── en.json    # English translations
└── ar.json    # Arabic translations
```

### Example Structure
```json
{
  "nav": {
    "home": "Home",
    "about": "About Us"
  },
  "common": {
    "loading": "Loading...",
    "error": "An error occurred"
  },
  "form": {
    "submit": "Submit",
    "validation": {
      "required": "This field is required",
      "email": "Please enter a valid email"
    }
  }
}
```

## RTL (Right-to-Left) Support

### Automatic RTL Switching
When Arabic is selected:
- `<html dir="rtl">` is set automatically
- CSS adjustments are applied via `[dir="rtl"]` selectors
- Text alignment changes to right-aligned

### Writing RTL-Friendly CSS

1. **Use logical properties when possible:**
   ```css
   /* Good - automatically handles RTL */
   margin-inline-start: 1rem;
   padding-inline-end: 0.5rem;
   
   /* Avoid - requires manual RTL overrides */
   margin-left: 1rem;
   padding-right: 0.5rem;
   ```

2. **Use RTL-specific selectors when needed:**
   ```css
   .my-component {
     text-align: left;
   }
   
   [dir="rtl"] .my-component {
     text-align: right;
   }
   ```

3. **Handle icons and directional elements:**
   ```css
   .arrow-right {
     /* Normal state */
   }
   
   [dir="rtl"] .arrow-right {
     transform: scaleX(-1); /* Flip horizontally */
   }
   ```

## Services

### LanguageService
The main service for language management:

```typescript
import { LanguageService } from './core/services/language.service';

constructor(private languageService: LanguageService) {}

// Get current language
const currentLang = this.languageService.getCurrentLanguage();

// Set language
this.languageService.setLanguage('ar');

// Switch between languages
this.languageService.switchLanguage();

// Check if RTL
const isRTL = this.languageService.isRTL();

// Get locale for pipes
const locale = this.languageService.getCurrentLocale();

// Listen to language changes
this.languageService.currentLanguage$.subscribe(lang => {
  console.log('Language changed to:', lang);
});
```

### MetaService
Handles SEO meta tags for different languages:

```typescript
import { MetaService } from './core/services/meta.service';

constructor(private metaService: MetaService) {}

// Update page meta tags
this.metaService.updatePageMeta({
  titleKey: 'meta.home.title',
  descriptionKey: 'meta.home.description'
});

// Predefined methods
this.metaService.updateHomeMeta();
this.metaService.updateProjectsMeta();
```

## Components

### Language Switcher
Already included in the navigation. To use elsewhere:

```html
<app-language-switcher></app-language-switcher>
```

### Adding Translation Support to New Components

1. **Import TranslateModule:**
   ```typescript
   import { TranslateModule } from '@ngx-translate/core';
   
   @Component({
     // ...
     imports: [TranslateModule],
     // ...
   })
   ```

2. **Use translations in template:**
   ```html
   <h1>{{ 'page.title' | translate }}</h1>
   <p>{{ 'page.description' | translate }}</p>
   ```

## Date, Number, and Currency Formatting

The system automatically uses the correct locale for Angular pipes:

```html
<!-- Date formatting -->
{{ date | date:'medium' }}

<!-- Number formatting -->
{{ number | number:'1.2-2' }}

<!-- Currency formatting -->
{{ price | currency }}
```

For Arabic locale, these will format according to Arabic locale conventions.

## Testing

### Unit Tests
Test language functionality:

```typescript
import { LanguageService } from './language.service';

describe('Component with translations', () => {
  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [TranslateModule.forRoot()]
    });
  });

  it('should handle language change', () => {
    const languageService = TestBed.inject(LanguageService);
    languageService.setLanguage('ar');
    
    expect(languageService.getCurrentLanguage()).toBe('ar');
    expect(languageService.isRTL()).toBe(true);
  });
});
```

### E2E Tests
Test language switching in the UI:

```typescript
it('should switch language and update UI', () => {
  // Click language switcher
  cy.get('[data-cy=language-switcher]').click();
  cy.get('[data-cy=language-option-ar]').click();
  
  // Verify language change
  cy.get('html').should('have.attr', 'dir', 'rtl');
  cy.get('html').should('have.attr', 'lang', 'ar');
  
  // Verify text changed
  cy.get('[data-cy=nav-home]').should('contain', 'الرئيسية');
});
```

## Adding a Third Language

1. **Add language to LanguageService:**
   ```typescript
   readonly supportedLanguages: LanguageOption[] = [
     // existing languages...
     {
       code: 'fr',
       name: 'French',
       nativeName: 'Français',
       dir: 'ltr'
     }
   ];
   ```

2. **Register locale data:**
   ```typescript
   import localeFr from '@angular/common/locales/fr';
   registerLocaleData(localeFr, 'fr');
   ```

3. **Create translation file:**
   ```
   src/assets/i18n/fr.json
   ```

4. **Update type definition:**
   ```typescript
   export type SupportedLanguage = 'en' | 'ar' | 'fr';
   ```

## Code Review Checklist

When reviewing PRs that add new UI elements:

- [ ] All user-visible text uses translation keys
- [ ] Translation keys are added to both `en.json` and `ar.json`
- [ ] RTL layout works correctly for Arabic
- [ ] No hardcoded text in templates or components
- [ ] Meta tags are translated for SEO
- [ ] Form validation messages are translated
- [ ] Date/number/currency formats work in both locales

## Best Practices

### Translation Keys
- Use descriptive, hierarchical keys
- Avoid overly long keys
- Group related translations
- Use consistent naming patterns

### RTL Design
- Test all UI components in RTL mode
- Use logical CSS properties where possible
- Consider icon direction and layout flow
- Test with longer Arabic text

### Performance
- Translation files are loaded lazily
- Avoid calling translation methods in templates repeatedly
- Use `OnPush` change detection when possible

### Accessibility
- Ensure `lang` attribute is set correctly
- Provide proper `dir` attribute for screen readers
- Test with Arabic screen readers when possible

## Troubleshooting

### Common Issues

1. **Translation not showing:**
   - Check if key exists in translation file
   - Verify TranslateModule is imported
   - Check browser console for errors

2. **RTL layout broken:**
   - Verify `[dir="rtl"]` CSS selectors
   - Check for hardcoded left/right styles
   - Test with longer Arabic text

3. **Language not persisting:**
   - Check localStorage in browser dev tools
   - Verify LanguageService initialization
   - Check for errors in browser console

### Debugging
Enable translation debug mode:

```typescript
// In app.config.ts
TranslateModule.forRoot({
  // ... other config
  missingTranslationHandler: {
    provide: MissingTranslationHandler,
    useClass: MyMissingTranslationHandler
  }
})
```

## Support

For questions about internationalization:
1. Check this documentation
2. Review existing translation patterns in the codebase
3. Test thoroughly in both languages
4. Consider RTL layout implications

Remember: Every user-facing string should be translatable, and every layout should work in both LTR and RTL modes.
