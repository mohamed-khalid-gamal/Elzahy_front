<section id="projects" class="py-20 content-bg-wrap">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div *ngIf="!isPage" class="text-center mb-12" [@fadeInUp]>
      <h2 class="text-4xl sm:text-5xl font-bold text-white mb-6 text-shadow">
        Our <span class="bg-gradient-to-r from-gray-200 to-gray-400 bg-clip-text text-transparent">Projects</span>
      </h2>
      <p class="text-lg sm:text-xl text-gray-300 max-w-3xl mx-auto">
        Showcasing our expertise in construction, excavation, and infrastructure development through successful project deliveries.
      </p>
      <div class="section-divider mt-8"></div>
    </div>

    <!-- Tabs for project categories (only shown on project page) -->
    <div *ngIf="isPage" class="flex justify-center mb-10">
      <div class="inline-flex h-auto items-center justify-center rounded-md p-1 glass-effect-dark text-muted-foreground">
        <button
          *ngFor="let tab of tabOptions"
          (click)="setActiveTab(tab.value)"
          [class]="'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm sm:px-4 sm:py-2 sm:text-base font-semibold transition-all ' + (activeTab === tab.value ? 'bg-white/20 text-white shadow-sm' : 'text-gray-300')"
        >
          {{ tab.label }}
        </button>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
      <p class="text-white mt-4">Loading projects...</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="text-center py-12 glass-card-dark rounded-xl">
      <p class="text-red-400 text-lg">{{ error }}</p>
      <button
        (click)="loadProjects()"
        class="mt-4 glass-card-dark hover:bg-white/20 text-white border-0 px-6 py-2 btn transition-all duration-300">
        Try Again
      </button>
    </div>

    <div *ngIf="!loading && !error" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" [@staggerIn]>
      <div
        *ngFor="let project of getCurrentProjects(); trackBy: trackByProjectId"
        class="glass-card-dark rounded-2xl overflow-hidden group cursor-pointer"
        [@cardHover]="cardHoverStates[project.id]"
        (mouseenter)="onCardHover(project.id, true)"
        (mouseleave)="onCardHover(project.id, false)"
        (click)="viewProjectDetails(project.id)"
      >
        <div class="relative overflow-hidden">
          <img
            [src]="getProjectImageUrl(project)"
            [alt]="project.name"
            [title]="project.name"
            (error)="$event.target.src='https://via.placeholder.com/400x250/1a1a1a/ffffff?text=No+Image'"
            class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>

          <!-- Image count badge (only show if multiple images) -->
          <div *ngIf="hasMultipleImages(project)" class="absolute top-4 left-4">
            <span class="glass-effect px-2 py-1 rounded-full text-xs font-medium text-gray-100 flex items-center">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
              </svg>
              {{ getImageCount(project) }}
            </span>
          </div>

          <!-- Status badge -->
          <div class="absolute top-4 right-4">
            <span class="glass-effect px-3 py-1 rounded-full text-sm font-medium text-gray-100">
              {{ getProjectStatusLabel(project.status) }}
            </span>
          </div>

          <div class="absolute bottom-4 left-4">
            <h3 class="text-xl font-bold text-white text-shadow">
              {{ project.name }}
            </h3>
          </div>
        </div>
        <div class="p-6">
          <p class="text-gray-300 mb-4 line-clamp-3">
            {{ project.description }}
          </p>
          <button
            (click)="viewProjectDetails(project.id); $event.stopPropagation()"
            class="group-hover:bg-white/10 text-gray-200 p-0 h-auto font-semibold hover:text-white transition-all duration-300 hover:scale-105 flex items-center"
          >
            View Details
            <svg class="ml-2 w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M7 17l9.2-9.2M17 17V7H7"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- No projects message -->
    <div *ngIf="getCurrentProjects().length === 0" class="col-span-full text-center py-12 glass-card-dark rounded-xl">
      <p class="text-xl text-gray-300">No projects in this category yet. Stay tuned!</p>
    </div>

    <div *ngIf="!isPage" class="text-center mt-16" [@fadeInUp]>
      <a routerLink="/projects" class="glass-card-dark hover:bg-white/20 text-white border-0 px-8 py-4 btn transition-all duration-300 hover:scale-105">
        View All Projects
      </a>
    </div>
  </div>
</section>
