<section id="projects" class="py-12 sm:py-16 lg:py-20 content-bg-wrap">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 project-container">
    <div *ngIf="!isPage" class="text-center mb-8 sm:mb-12" [@fadeInUp]>
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4 sm:mb-6 text-shadow">
        {{ 'projects.title' | translate }}
      </h2>
      <p class="text-base sm:text-lg lg:text-xl text-gray-300 max-w-3xl mx-auto px-4">
        {{ 'projects.subtitle' | translate }}
      </p>
      <div class="section-divider mt-6 sm:mt-8"></div>
    </div>

    <!-- Tabs for project categories (only shown on project page) -->
    <div *ngIf="isPage" class="flex justify-center mb-8 sm:mb-10 px-4">
      <div class="inline-flex h-auto items-center justify-center border-2 border-gray-600 p-1 glass-effect-dark text-muted-foreground overflow-x-auto">
        <button
          *ngFor="let tab of tabOptions"
          (click)="setActiveTab(tab.value)"
          [class]="'inline-flex items-center justify-center whitespace-nowrap border px-2 py-1.5 text-xs sm:px-3 sm:py-1.5 sm:text-sm md:px-4 md:py-2 md:text-base font-semibold transition-all ' + (activeTab === tab.value ? 'bg-white/20 border-gray-400 text-white shadow-sm' : 'border-transparent text-gray-300 hover:border-gray-500')"
        >
          {{ tab.label | translate }}
        </button>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
      <p class="text-white mt-4">{{ 'common.loading' | translate }}</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="text-center py-12 glass-card-dark border-2 border-gray-600">
      <p class="text-red-400 text-lg">{{ error }}</p>
      <button
        (click)="loadProjects()"
        class="mt-4 glass-card-dark hover:bg-white/20 text-white border-2 border-gray-500 hover:border-gray-400 px-6 py-2 btn transition-all duration-300">
        {{ 'common.retry' | translate }}
      </button>
    </div>

    <div *ngIf="!loading && !error" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8" [@staggerIn]>
      <div
        *ngFor="let project of getCurrentProjects(); trackBy: trackByProjectId"
        class="glass-card-dark border-2 border-gray-600 hover:border-gray-400 overflow-hidden group cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-2xl"
        [@cardHover]="cardHoverStates[project.id]"
        (mouseenter)="onCardHover(project.id, true)"
        (mouseleave)="onCardHover(project.id, false)"
        (click)="viewProjectDetails(project.id)"
      >
        <div class="relative overflow-hidden">
          <img
            [src]="getProjectImageUrl(project)"
            [alt]="('projects.imageAlt' | translate:{ name: project.name })"
            [title]="project.name + ' - ' + ('projects.imageTitle' | translate)"
            loading="lazy"
            decoding="async"
            (error)="handleImageError($event, project)"
            (load)="handleImageLoad($event)"
            class="w-full h-48 sm:h-56 md:h-64 object-cover transition-transform duration-500 group-hover:scale-110 bg-gray-800"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>

          <!-- Video play overlay (show if main item is video or if has videos but no images) -->
          <div *ngIf="(!hasImages(project) && hasVideos(project))" class="absolute inset-0 flex items-center justify-center">
            <div class="bg-black/50 rounded-full p-3 hover:bg-black/70 transition-colors">
              <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
              </svg>
            </div>
          </div>

          <!-- Gallery count badge (show total media count if has multiple items) -->
          <div *ngIf="hasMultipleImages(project) || hasVideos(project)" class="absolute top-4 left-4">
            <span class="glass-effect px-3 py-1 border border-gray-400 text-xs font-medium text-gray-100 flex items-center">
              <svg *ngIf="hasImages(project)" class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
              </svg>
              <svg *ngIf="!hasImages(project) && hasVideos(project)" class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
              </svg>
              <span *ngIf="hasImages(project) && hasVideos(project)">{{ getImageCount(project) + (hasVideos(project) ? project.videos.length : 0) }}</span>
              <span *ngIf="hasImages(project) && !hasVideos(project)">{{ getImageCount(project) }}</span>
              <span *ngIf="!hasImages(project) && hasVideos(project)">{{ project.videos.length }}</span>
            </span>
          </div>

          <!-- Status badge -->
          <div class="absolute top-4 right-4">
            <span class="glass-effect px-3 py-1 border border-gray-400 text-sm font-medium text-gray-100">
              {{ getProjectStatusLabel(project.status) }}
            </span>
          </div>

          <div class="absolute bottom-4 left-4">
            <h3 class="text-xl font-bold text-white text-shadow">
              {{ project.name }}
            </h3>
          </div>
        </div>
        <div class="p-4 sm:p-6">
          <p class="text-gray-300 mb-4 text-sm sm:text-base line-clamp-3">
            {{ project.description }}
          </p>

          <!-- Real Estate Information -->
          <div class="mb-4 space-y-1 sm:space-y-2">
            <div *ngIf="project.location" class="flex items-center text-xs sm:text-sm text-gray-400">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
              </svg>
              <span class="truncate">{{ project.location }}</span>
            </div>

            <div *ngIf="project.propertyType" class="flex items-center text-xs sm:text-sm text-gray-400">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
              <span class="truncate">{{ project.propertyType }}</span>
            </div>

            <div *ngIf="project.priceRange" class="flex items-center text-xs sm:text-sm text-green-400 font-semibold">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
              </svg>
              <span class="truncate">{{ project.priceRange }}</span>
            </div>

            <div *ngIf="project.totalUnits" class="flex items-center text-xs sm:text-sm text-gray-400">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
              </svg>
              <span class="truncate">{{ project.totalUnits }} {{ 'projects.info.units' | translate }}</span>
            </div>

            <div *ngIf="project.projectArea" class="flex items-center text-xs sm:text-sm text-gray-400">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15 13.586V12a1 1 0 011-1z" clip-rule="evenodd"/>
              </svg>
              <span class="truncate">{{ getFormattedArea(project) }}</span>
            </div>
          </div>

          <!-- Media badges -->
          <div class="flex items-center flex-wrap gap-2 sm:gap-3 mb-4">
            <div *ngIf="hasMultipleImages(project)" class="flex items-center text-xs text-gray-400">
              <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
              </svg>
              <span class="whitespace-nowrap">{{ getImageCount(project) }} {{ 'projects.info.photos' | translate }}</span>
            </div>

            <div *ngIf="hasVideos(project)" class="flex items-center text-xs text-gray-400">
              <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
              </svg>
              <span class="whitespace-nowrap">{{ getVideoCount(project) }} {{ 'projects.info.videos' | translate }}</span>
            </div>

            <div *ngIf="isFeaturedProject(project)" class="flex items-center text-xs text-yellow-400">
              <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
              <span class="whitespace-nowrap">{{ 'projects.info.featured' | translate }}</span>
            </div>
          </div>

          <button
            (click)="viewProjectDetails(project.id); $event.stopPropagation()"
            class="w-full sm:w-auto group-hover:bg-white/10 text-gray-200 border border-gray-500 hover:border-gray-400 p-2 sm:p-0 sm:h-auto font-semibold hover:text-white transition-all duration-300 hover:scale-105 flex items-center justify-center sm:justify-start text-sm sm:text-base"
          >
            <span class="truncate">{{ 'projects.viewDetails' | translate }}</span>
            <svg class="ml-2 w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M7 17l9.2-9.2M17 17V7H7"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- No projects message -->
    <div *ngIf="getCurrentProjects().length === 0 && !loading" class="col-span-full text-center py-12 glass-card-dark border-2 border-gray-600">
      <p class="text-lg sm:text-xl text-gray-300">{{ 'projects.noProjects' | translate }}</p>
    </div>

    <!-- Pagination (only show on projects page) -->
    <div *ngIf="isPage && totalPages > 1 && !loading" class="mt-8 sm:mt-12 flex justify-center px-4">
      <nav class="flex items-center space-x-1 overflow-x-auto">
        <!-- Previous button -->
        <button
          (click)="previousPage()"
          [disabled]="!hasPrevious"
          title="{{ ('common.previous' | translate) + ' ' + ('common.page' | translate) }}"
          aria-label="{{ ('common.previous' | translate) + ' ' + ('common.page' | translate) }}"
          class="px-2 sm:px-3 py-2 border border-gray-500 text-sm font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed glass-card-dark hover:bg-white/20 hover:border-gray-400 text-white"
        >
          <span class="sr-only">{{ ('common.previous' | translate) + ' ' + ('common.page' | translate) }}</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>

        <!-- Page numbers -->
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="goToPage(page)"
          title="{{ ('common.page' | translate) + ' ' + page }}"
          aria-label="{{ ('common.page' | translate) + ' ' + page }}"
          [attr.aria-current]="page === currentPage ? 'page' : null"
          [class]="'px-3 sm:px-4 py-2 border text-sm font-medium transition-all duration-200 ' + (page === currentPage ? 'bg-white/20 border-gray-400 text-white' : 'glass-card-dark border-gray-500 hover:bg-white/10 hover:border-gray-400 text-gray-300')"
        >
          {{ page }}
        </button>

        <!-- Next button -->
        <button
          (click)="nextPage()"
          [disabled]="!hasNext"
          title="{{ ('common.next' | translate) + ' ' + ('common.page' | translate) }}"
          aria-label="{{ ('common.next' | translate) + ' ' + ('common.page' | translate) }}"
          class="px-2 sm:px-3 py-2 border border-gray-500 text-sm font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed glass-card-dark hover:bg-white/20 hover:border-gray-400 text-white"
        >
          <span class="sr-only">{{ ('common.next' | translate) + ' ' + ('common.page' | translate) }}</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </nav>
    </div>

    <!-- Results info -->
    <div *ngIf="isPage && !loading" class="mt-6 sm:mt-8 text-center text-gray-400 text-xs sm:text-sm px-4">
      {{ 'projects.pagination.showing' | translate:{ from: (currentPage - 1) * pageSize + 1, to: getEndIndex(), total: totalCount } }}
    </div>

    <div *ngIf="!isPage" class="text-center mt-12 sm:mt-16" [@fadeInUp]>
      <a routerLink="/projects" class="glass-card-dark hover:bg-white/20 text-white border-2 border-gray-500 hover:border-gray-400 px-6 sm:px-8 py-3 sm:py-4 btn transition-all duration-300 hover:scale-105 text-sm sm:text-base">
        {{ 'projects.viewAll' | translate }}
      </a>
    </div>
  </div>
</section>
