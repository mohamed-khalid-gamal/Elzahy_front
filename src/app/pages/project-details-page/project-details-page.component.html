<div class="min-h-screen content-bg-wrap">
  <!-- Loading state -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-screen">
    <div class="text-center">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
      <p class="text-white mt-4 text-lg">{{ 'projectDetails.loading' | translate }}</p>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="flex items-center justify-center min-h-screen ">
    <div class="text-center py-23 pb-8 glass-card-dark rounded-xl max-w-md mx-4">
      <div class="text-red-400 text-6xl mb-4">⚠️</div>
      <p class="text-red-400 text-lg mb-6">{{ error }}</p>
      <div class="space-x-4">
        <button
          (click)="goBack()"
          class="glass-card-dark hover:bg-white/20 text-white border-0 px-6 py-3 btn transition-all duration-300">
          {{ 'projectDetails.buttons.back' | translate }}
        </button>
        <button
          (click)="retryLoadProject()"
          class="bg-blue-600 hover:bg-blue-700 text-white border-0 px-6 py-3 btn transition-all duration-300">
          {{ 'common.retry' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Project details content -->
  <div *ngIf="project && !loading && !error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">

    <!-- Back button -->
    <div class="mb-8" [@fadeInUp]>
      <button
        (click)="goBack()"
        class="glass-card-dark hover:bg-white/20 text-white border-0 px-4 py-2 btn transition-all duration-300 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        {{ 'projectDetails.buttons.back' | translate }}
      </button>
    </div>
    <!-- Hero section with image/video gallery and title -->
    <div class="glass-card-dark rounded-2xl overflow-hidden mb-8" [@fadeInUp]>
      <!-- Project Gallery (Images + Videos) or Single Item -->
      <div class="relative">
        <!-- Enhanced Media Gallery -->
        <div *ngIf="hasGalleryContent(project)">
          <div class="relative">
            <!-- Use the enhanced ImageGalleryComponent with both images and videos -->
            <app-image-gallery
              [images]="project.images || []"
              [videos]="project.videos || []"
              [showThumbnails]="true">
            </app-image-gallery>

            <!-- Overlay for project title if single item -->
            <div *ngIf="!hasMultipleGalleryItems(project)" class="absolute bottom-0 left-0 right-0 p-6 sm:p-8 bg-gradient-to-t from-black/80 via-black/20 to-transparent rounded-b-lg">
              <div class="flex flex-wrap items-center gap-4 mb-4">
                <span [class]="'px-3 py-1 rounded-full text-sm font-medium border ' + getProjectStatusClass(project.status)">
                  {{ getProjectStatusLabel(project.status) }}
                </span>
                <span *ngIf="project.client" class="glass-effect px-3 py-1 rounded-full text-sm font-medium text-gray-100">
                  {{ 'projectDetails.client' | translate }}: {{ project.client }}
                </span>
              </div>
              <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white text-shadow mb-4">
                {{ project.name }}
              </h1>
              <p class="text-lg sm:text-xl text-gray-200 max-w-3xl">
                {{ project.description }}
              </p>
            </div>
          </div>
        </div>

        <!-- No gallery content: Fallback -->
        <div *ngIf="!hasGalleryContent(project)" class="relative h-96 sm:h-[500px]">
          <img
            src="/public/no-image.svg"
            [alt]="project.name + ' - ' + ('projectDetails.noImage' | translate)"
            [title]="project.name + ' - ' + ('projectDetails.noImage' | translate)"
            class="w-full h-full object-cover"
            loading="eager"
            decoding="async"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>

          <!-- Project title overlay for fallback -->
          <div class="absolute bottom-0 left-0 right-0 p-6 sm:p-8">
            <div class="flex flex-wrap items-center gap-4 mb-4">
              <span [class]="'px-3 py-1 rounded-full text-sm font-medium border ' + getProjectStatusClass(project.status)">
                {{ getProjectStatusLabel(project.status) }}
              </span>
              <span *ngIf="project.client" class="glass-effect px-3 py-1 rounded-full text-sm font-medium text-gray-100">
                {{ 'projectDetails.client' | translate }}: {{ project.client }}
              </span>
            </div>
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white text-shadow mb-4">
              {{ project.name }}
            </h1>
            <p class="text-lg sm:text-xl text-gray-200 max-w-3xl">
              {{ project.description }}
            </p>
          </div>
        </div>
      </div>

      <!-- Project title section for multiple gallery items (separate from overlay) -->
      <div *ngIf="hasMultipleGalleryItems(project)" class="p-6 sm:p-8 bg-gradient-to-r from-gray-900/80 to-gray-800/80">
        <div class="flex flex-wrap items-center gap-4 mb-4">
          <span [class]="'px-3 py-1 rounded-full text-sm font-medium border ' + getProjectStatusClass(project.status)">
            {{ getProjectStatusLabel(project.status) }}
          </span>
          <span *ngIf="project.client" class="glass-effect px-3 py-1 rounded-full text-sm font-medium text-gray-100">
            {{ 'projectDetails.client' | translate }}: {{ project.client }}
          </span>
          <!-- Gallery count badge -->
          <span class="glass-effect px-3 py-1 rounded-full text-sm font-medium text-gray-100 flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
            </svg>
            {{ getTotalGalleryCount(project) }} {{ 'projectDetails.gallery.items' | translate }}
            <span *ngIf="hasImages(project) && hasVideos(project)" class="ml-1 text-xs opacity-75">
              ({{ getImageCount(project) }} {{ 'projects.info.photos' | translate }}, {{ getVideoCount(project) }} {{ 'projects.info.videos' | translate }})
            </span>
          </span>
        </div>
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4">
          {{ project.name }}
        </h1>
        <p class="text-lg sm:text-xl text-gray-200 max-w-4xl">
          {{ project.description }}
        </p>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Main content -->
      <div class="lg:col-span-2 space-y-8">

        <!-- Project Information -->
        <div class="glass-card-dark rounded-xl p-6" [@slideIn]>
          <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            {{ 'projectDetails.info.title' | translate }}
          </h2>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6" [@staggerIn]>
            <div *ngIf="project.location">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.location' | translate }}</h3>
              <p class="text-white text-lg flex items-center">
                <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                {{ project.location }}
              </p>
            </div>

            <div *ngIf="project.propertyType">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.propertyType' | translate }}</h3>
              <p class="text-white text-lg">{{ project.propertyType }}</p>
            </div>

            <div *ngIf="project.totalUnits">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.totalUnits' | translate }}</h3>
              <p class="text-white text-lg font-semibold">{{ getFormattedUnits(project) }}</p>
            </div>

            <div *ngIf="project.projectArea">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.projectArea' | translate }}</h3>
              <p class="text-white text-lg font-semibold">{{ getFormattedArea(project) }}</p>
            </div>

            <div *ngIf="project.priceStart || project.priceEnd || project.priceRange">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.priceRange' | translate }}</h3>
              <p class="text-white text-lg font-bold text-green-400">{{ getFormattedPriceRange(project) }}</p>
            </div>

            <div>
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.status' | translate }}</h3>
              <span [class]="'inline-block px-3 py-1 rounded-full text-sm font-medium border ' + getProjectStatusClass(project.status)">
                {{ getProjectStatusLabel(project.status) }}
              </span>
            </div>

            <div *ngIf="project.startDate">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.startDate' | translate }}</h3>
              <p class="text-white text-lg">{{ formatDate(project.startDate) }}</p>
            </div>

            <div *ngIf="project.endDate">
              <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-2">{{ 'projectDetails.info.endDate' | translate }}</h3>
              <p class="text-white text-lg">{{ formatDate(project.endDate) }}</p>
            </div>
          </div>
        </div>

        <!-- Construction Technologies / Amenities -->
        <div *ngIf="getProjectTechnologies(project).length > 0" class="glass-card-dark rounded-xl p-6" [@slideIn]>
          <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            {{ 'projectDetails.tech.title' | translate }}
          </h2>

          <div class="flex flex-wrap gap-3" [@staggerIn]>
            <span
              *ngFor="let tech of getProjectTechnologies(project)"
              class="glass-effect px-4 py-2 rounded-full text-sm font-medium text-gray-100 hover:bg-white/20 transition-colors duration-300">
              {{ tech }}
            </span>
          </div>
        </div>

        <!-- Project Links -->
        <div *ngIf="project.companyUrl || project.googleMapsUrl || project.projectUrl" class="glass-card-dark rounded-xl p-6" [@slideIn]>
          <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 0 0-5.656 0l-4 4a4 4 0 1 0 5.656 5.656l1.102-1.101m-.758-4.899a4 4 0 0 0 5.656 0l4-4a4 4 0 0 0-5.656-5.656l-1.1 1.1"/>
            </svg>
            {{ 'projectDetails.resources.title' | translate }}
          </h2>

          <div class="flex flex-wrap gap-4" [@staggerIn]>
            <button
              *ngIf="project.companyUrl"
              (click)="openCompanyUrl(project.companyUrl)"
              class="bg-blue-600 hover:bg-blue-700 text-white border-0 px-6 py-3 btn transition-all duration-300 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
              </svg>
              {{ 'projectDetails.resources.companyWebsite' | translate }}
            </button>

            <button
              *ngIf="project.googleMapsUrl"
              (click)="openGoogleMaps(project.googleMapsUrl)"
              class="bg-green-600 hover:bg-green-700 text-white border-0 px-6 py-3 btn transition-all duration-300 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              {{ 'projectDetails.resources.maps' | translate }}
            </button>

            <button
              *ngIf="project.projectUrl"
              (click)="openProjectUrl(project.projectUrl)"
              class="glass-card-dark hover:bg-white/20 text-white border-0 px-6 py-3 btn transition-all duration-300 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
              {{ 'projectDetails.resources.projectWebsite' | translate }}
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-8">

        <!-- Related Projects -->
        <div *ngIf="relatedProjects.length > 0" class="glass-card-dark rounded-xl p-6" [@slideIn]>
          <h2 class="text-xl font-bold text-white mb-6">{{ 'projectDetails.related.title' | translate }}</h2>

          <div class="space-y-4" [@staggerIn]>
            <div
              *ngFor="let relatedProject of relatedProjects"
              (click)="navigateToRelatedProject(relatedProject.id)"
              class="glass-effect rounded-lg p-4 cursor-pointer hover:bg-white/10 transition-all duration-300 group">

              <div class="flex space-x-3">
                <img
                  [src]="getProjectImageUrl(relatedProject)"
                  [alt]="relatedProject.name"
                  [title]="relatedProject.name + ' - ' + ('projects.imageTitle' | translate)"
                  (error)="$event.target.src='/public/no-image.svg'"
                  class="w-16 h-12 object-cover rounded"
                />
                <div class="flex-1 min-w-0">
                  <h3 class="text-white font-medium group-hover:text-blue-300 transition-colors duration-300 truncate">
                    {{ relatedProject.name }}
                  </h3>
                  <p class="text-gray-400 text-sm truncate">
                    {{ relatedProject.description }}
                  </p>
                  <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full glass-effect text-gray-300">
                    {{ getProjectStatusLabel(relatedProject.status) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Project Meta -->
        <div class="glass-card-dark rounded-xl p-6" [@slideIn]>
          <h2 class="text-xl font-bold text-white mb-6">{{ 'projectDetails.meta.title' | translate }}</h2>

          <div class="space-y-4 text-sm">
            <div>
              <span class="text-gray-400">{{ 'projectDetails.meta.created' | translate }}</span>
              <span class="text-white ml-2">{{ formatDate(project.createdAt) }}</span>
            </div>
            <div>
              <span class="text-gray-400">{{ 'projectDetails.meta.updated' | translate }}</span>
              <span class="text-white ml-2">{{ formatDate(project.updatedAt) }}</span>
            </div>
            <div *ngIf="project.createdByName">
              <span class="text-gray-400">{{ 'projectDetails.meta.createdBy' | translate }}</span>
              <span class="text-white ml-2">{{ project.createdByName }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
